/*!
 * responsiveCarousel
 * A responsive carousel that works in desktop browsers, ipad, iphone, and even
 * most Androids.  It uses css3 animations with a jquery animation fallback for
 * greater speed.  The code was optimized to minimize page reflows to further
 * enhance the overall speed.  Doesn't try and solve everything, small and
 * compact for specific use..
 *
 * This is a jQuery UI Widget
 *
 * @version 0.6.0
 * @releaseDate 1/17/2013
 * @author Matthew Toledo
 * @url https://github.com/mrbinky3000/responsive_carousel
 * @requires jQuery, jQuery UI (only the Core and Widget Factory), modernizr (only css3 transitions test, touch test optional), hammer.js
 */
(function(f,h,r){var j=!1;f.widget("ri.responsiveCarousel",{options:{autoWrap:!1,arrowLeft:".arrow-left span",arrowRight:".arrow-right span",mask:".slider-mask",target:"ul",unitElement:"li",unitWidth:"inherit",responsiveUnitSize:null,onRedraw:null,dragEvents:!1,speed:400,slideSpeed:2500,step:-1,responsiveStep:null,onShift:null,cssAnimations:Modernizr.csstransitions,nudgeThreshold:10,infinite:!1},internal:{currentSlide:0,left:0,targetWidth:0,unitWidth:0,targetOuterWidth:0,targetOuterHeight:0,targetParentOuterWidth:0,
targetParentInnerWidth:0,targetParentOuterHeight:0,targetParentMarginLeft:0,targetBackupCopy:null,isArrowBeingClicked:!1,arrowLeftVisible:!0,arrowRightVisible:!0,targetLeft:0,timer:null,firstMouseClick:!1,prefix:null,slideShowActive:!1,slideTimer:null,slideBumped:!1,nudgeDirection:null,infinite:!1,numUnits:0,numVisibleUnits:0,scrollStart:0},wait:function(){var b;return{thenDo:function(c,d){void 0!==b&&h.clearTimeout(b);b=h.setTimeout(c,d)}}},_getPrefix:function(b){for(var c=["Moz","Webkit","Khtml",
"0","ms"],d=r.createElement("div"),e=b.charAt(0).toUpperCase()+b.slice(1),a="",g=c.length;-1<g;)void 0!==d.style[c[g]+e]&&(a=c[g]),g-=1;return a=d.style[b]?b.toLowerCase():"-"+a.toLowerCase()+"-"},_animate:function(b,c,d,e){var a=this.options,g=this.internal,k=g.prefix+"transition",m=b.position().left,l=c.left,j=m+l;!0===a.infinite&&void 0!==l&&(l<m?(l=-1*g.unitWidth*(g.numUnits-g.numVisibleUnits),m===l&&(b.css({transition:"",left:0}),c.left=-g.unitWidth)):l>m&&0===m&&(l=-1*b.find(".clone:first").position().left,
b.css({transition:"",left:l}),c.left=l+j));h.setTimeout(function(){a.cssAnimations?(b.css(k,"all "+d/1E3+"s ease-in-out").css(c),h.setTimeout(function(){b.css(k,"");f.isFunction(e)&&e()},d)):b.animate(c,d,function(){f.isFunction(e)&&e()})},1)},_setTargetWidth:function(){var b=this.internal,c=this.options,d=f(this.element),e=f(this.element).find(c.target);b.numUnits=e.find(c.unitElement).length;"individual"===c.unitWidth?(b.targetWidth=0,d.find(c.unitElement).each(function(){var a=f(this),c=0;a.css("width",
"");c=a.outerWidth();b.targetWidth+=c;f(this).data("responsiveCarousel",{width:c,top:a.position().top,right:a.position().left+a.outerWidth(),bottom:a.position().top+a.outerHeight(),left:a.position().left})})):b.targetWidth=b.numUnits*b.unitWidth;d.find(c.target).width(b.targetWidth);b.targetOuterWidth=e.outerWidth();b.targetOuterHeight=e.outerHeight();b.targetParentOuterWidth=e.parent().outerWidth();b.targetParentInnerWidth=e.parent().innerWidth();b.targetParentOuterHeight=e.parent().outerHeight();
b.targetParentMarginLeft=parseInt(e.parents().css("marginLeft"),10);isNaN(b.targetParentMarginLeft)&&(b.targetParentMarginLeft=0)},_setArrowVisibility:function(){var b=this.options,c=this.internal,d=f(this.element).find(b.target),e=d.position().left,a=c.targetOuterWidth+e,g=f(b.arrowLeft),k=f(b.arrowRight),m=c.targetParentOuterWidth;!0!==b.infinite&&a<=m?(k.addClass("disabled"),!0===c.isArrowBeingClicked&&this._clearInterval(),c.arrowRightVisible=c.isArrowBeingClicked=!1):!1===c.arrowRightVisible&&
(k.removeClass("disabled"),c.arrowRightVisible=!0);!0!==b.infinite&&0<=e?(g.addClass("disabled"),!0===c.isArrowBeingClicked&&this._clearInterval(),c.arrowLeftVisible=c.isArrowBeingClicked=!1):!1===c.arrowLeftVisible&&(g.removeClass("disabled"),c.arrowLeftVisible=!0);if("individual"===b.unitWidth)for(g=0;g<c.numUnits;g++){if(a=d.find(b.unitElement).eq(g),Math.abs(e)>=a.data("responsiveCarousel").left&&Math.abs(e)<a.data("responsiveCarousel").right){c.currentSlide=a.data("slide");break}}else c.currentSlide=
f(d.find(b.unitElement)[Math.abs(e/c.unitWidth)]).data("slide");if(f.isFunction(b.onShift))b.onShift(c.currentSlide)},_clearInterval:function(){var b=this.internal,c=this.options,d=f(this.element).find(c.target);"number"===typeof b.timer&&(b.isArrowBeingClicked=!1,h.clearInterval(b.timer));!1===j&&(j=!0,this._animate(d,{left:this.computeAdjust(d)},c.speed,function(){j=!1}))},_doArrowBeingClicked:function(b){var c=this,d=this.internal,e=this.options,a=f(this.element).find(e.target),g=a.position().left,
k=d.targetParentMarginLeft;if(!0!==j){if("individual"===e.unitWidth)if("right"===b)b=a.find(e.unitElement).eq(d.currentSlide+1).length?-1*a.find(e.unitElement).eq(d.currentSlide+1).data("responsiveCarousel").left:g-(d.nudgeThreshold?d.nudgeThreshold:20);else if("left"===b)b=a.find(e.unitElement).eq(d.currentSlide-1).length?-1*a.find(e.unitElement).eq(d.currentSlide-1).data("responsiveCarousel").left:g+(d.nudgeThreshold?d.nudgeThreshold:20);else throw Error("unknown direction");else if("left"===b)b=
g-k+d.unitWidth;else if("right"===b)b=g-k-d.unitWidth;else throw Error("unknown direction");j=!0;this._animate(a,{left:b},e.speed,function(){c._setArrowVisibility();j=!1})}},_setArrowEvents:function(){var b=this,c=this.options,d=this.internal,e=f(c.arrowLeft),a=f(c.arrowRight),g="",k="";e.on("click.responsiveCarousel",function(a){a.preventDefault()});a.on("click.responsiveCarousel",function(a){a.preventDefault()});!0===c.dragEvents?(g="mousedown.responsiveCarousel touchstart.responsiveCarousel",k=
"mouseup.responsiveCarousel touchend.responsiveCarousel"):(g="mousedown.responsiveCarousel",k="mouseup.responsiveCarousel");e.on(g,function(a){a.preventDefault();!1===j&&!e.hasClass("disabled")&&(d.isArrowBeingClicked=d.firstMouseClick=!0,d.timer=h.setInterval(function(){b._doArrowBeingClicked("left")},10),d.slideTimer&&(h.clearInterval(d.slideTimer),d.slideShowActive=!1))});a.on(g,function(){!1===j&&!a.hasClass("disabled")&&(d.isArrowBeingClicked=d.firstMouseClick=!0,d.timer=h.setInterval(function(){b._doArrowBeingClicked("right")},
10),d.slideTimer&&(h.clearInterval(d.slideTimer),d.slideShowActive=!1))});f.each([e,a],function(){f(this).on(k,function(){!0===d.isArrowBeingClicked&&b._clearInterval()})})},_setUnitWidth:function(){var b,c,d=this,e=this.internal,a=this.options,g=f(this.element).find(a.target),k=f(this.element),m=g.find(a.unitElement+":not(.clone)"),l=m.eq(0),j=new this.wait,n=function(){e.unitWidth=l.outerWidth()},q=function(){var d=k.find(a.mask).innerWidth(),f=null;c=a.responsiveUnitSize(k,e,a);if("number"!==typeof c||
1>c)throw Error("The responsiveUnitSize callback must return a whole number greater than 0");b=d/c;b=Math.floor(b);g.find(a.unitElement).css("width",b);e.unitWidth=b;e.numVisibleUnits=c;!0===a.infinite&&1<c&&(f=c,g.find(".clone").remove(),m.slice(0,f).clone(!0).addClass("clone").appendTo(g))};if("inherit"===a.unitWidth)n(),g.find("img").on("load.responsiveCarousel",function(){n();d._setTargetWidth("inherit");d._setArrowVisibility();if(f.isFunction(a.onRedraw))a.onRedraw(k,e,a)});else if("individual"===
a.unitWidth){if(f.isFunction(a.onRedraw))a.onRedraw(k,e,a);g.find("img").on("load",function(){d._setTargetWidth("individual");d._setArrowVisibility();if(f.isFunction(a.onRedraw))a.onRedraw(k,e,a)});f(h).on("resize.responsiveCarousel",function(){j.thenDo(function(){var b;d._setTargetWidth("individual (window resize)");b=-1*g.find(a.unitElement).eq(e.currentSlide).data("responsiveCarousel").left;g.css({left:b});d._setArrowVisibility();if(f.isFunction(a.onRedraw))a.onRedraw(k,e,a)},100)})}else if("compute"===
a.unitWidth){n();f.isFunction(a.responsiveUnitSize)&&(q(),n());if(f.isFunction(a.onRedraw))a.onRedraw(k,e,a);g.find("img").on("load",function(){f.isFunction(a.responsiveUnitSize)&&q();n();d._setTargetWidth("compute");d._setArrowVisibility();if(f.isFunction(a.onRedraw))a.onRedraw(k,e,a)});f(h).on("resize.responsiveCarousel",function(){j.thenDo(function(){f.isFunction(a.responsiveUnitSize)&&q();n();d._setTargetWidth("compute (window resize)");g.css({left:-1*e.currentSlide*e.unitWidth});d._setArrowVisibility();
if(f.isFunction(a.onRedraw))a.onRedraw(k,e,a)},100)})}else e.unitWidth=a.unitWidth},_dragEvents:function(){var b=this,c=this.options,d=this.internal,e=f(this.element).find(c.target),a=e.parent(),a=new Hammer(a.get(0),{drag:!0,drag_vertical:!1,drag_horizontal:!0,drag_min_distance:0,transform:!1,tap:!1,tap_double:!1,hold:!1}),g={};a.ondragstart=function(){if(!0===d.isArrowBeingClicked||!0===j)return{};j=!0;g={top:parseInt(e.css("top"),10),left:parseInt(e.css("left"),10)};g.time=(new Date).getTime();
d.scrollStart=g};a.ondrag=function(a){if(!0!==d.isArrowBeingClicked){var b,f,h=-1*d.unitWidth*(d.numUnits-d.numVisibleUnits);if("up"===a.direction||"left"===a.direction)a.distance*=-1;b=g.left+3*a.distance;f=Math.abs(d.scrollStart.left-b);d.nudgeDirection=f>c.nudgeThreshold&&f<d.unitWidth/2?"up"===a.direction||"left"===a.direction?"left":"right":null;!0===c.infinite&&(b<=h&&(b=0+3*a.distance),0<=b&&(b=h+3*a.distance));d.left=b;e.css("left",b)}};a.ondragend=function(){e.stop(!0,!1);b._animate(e,{left:b.computeAdjust(e)},
c.speed,function(){b._setArrowVisibility();j=!1})}},_initAnimationFrame:function(){for(var b=0,c=["ms","moz","webkit","o"],d=0;d<c.length&&!h.requestAnimationFrame;++d)h.requestAnimationFrame=h[c[d]+"RequestAnimationFrame"],h.cancelAnimationFrame=h[c[d]+"CancelAnimationFrame"]||h[c[d]+"CancelRequestAnimationFrame"];h.requestAnimationFrame||(h.requestAnimationFrame=function(c){var a=(new Date).getTime(),d=Math.max(0,16-(a-b)),f=h.setTimeout(function(){c(a+d)},d);b=a+d;return f});h.cancelAnimationFrame||
(h.cancelAnimationFrame=function(b){clearTimeout(b)})},_create:function(){var b=this.options,c=this.internal,d=f(this.element),e=f(this.element).find(b.target);this._initAnimationFrame();this.internal.targetBackupCopy=this.element;this.options.cssAnimations&&(this.internal.prefix=this._getPrefix("transition"));e.css({position:"relative",left:0});e.find(b.unitElement).each(function(a){f(this).attr({"data-slide":a})});!0===b.dragEvents&&this._dragEvents();this._setArrowEvents();this._setUnitWidth();
this._setTargetWidth("first load");this._setArrowVisibility();if(f.isFunction(b.onRedraw))b.onRedraw(d,c,b)},redraw:function(){var b=this.internal,c=this.options,d=f(this.element);this._setUnitWidth();this._setTargetWidth("_redraw");this._setArrowVisibility();if(f.isFunction(this.options.onRedraw))this.options.onRedraw(d,b,c)},getCurrentSlide:function(){return this.internal.currentSlide},goToSlide:function(b,c){var d=this,e=this.internal,a=this.options,g=f(this.element).find(a.target);c=void 0!==
c?c:!0;this._setUnitWidth();e="individual"===a.unitWidth?g.find(a.unitElement).eq(b).data("responsiveCarousel").left:-1*b*e.unitWidth;j=!0;!0===c?this._animate(g,{left:e},a.speed,function(){j=!1;d._setArrowVisibility()}):g.css("left",e)},toggleSlideShow:function(){var b=this,c=this.internal,d=this.options,e=f(this.element).find(d.target);!1===c.slideShowActive?(c.slideShowActive=!0,c.slideTimer=h.setInterval(function(){var a=d.step,g=c.targetParentInnerWidth,f=e.position().left,h=f+c.targetWidth,
l=f+a*c.unitWidth,a=h+a*c.unitWidth,p=l;!1===c.slideBumped?!1===d.infinite&&(a<=g&&(p=l+g-a,c.slideBumped="left"),0<=l&&(c.slideBumped="right",p=0)):("left"===c.slideBumped&&(p=0),"right"===c.slideBumped&&(p=f+g-h),c.slideBumped=!1);j=!0;b._animate(e,{left:p},d.speed,function(){j=!1;b._setArrowVisibility()})},d.slideSpeed)):!0===c.slideShowActive&&(c.slideShowActive=!1,h.clearInterval(c.slideTimer))},destroy:function(){f(h).unbind(".responsiveCarousel");f(this.element).find(this.options.arrowLeft).unbind(".responsiveCarousel");
f(this.element).find(this.options.arrowRight).unbind(".responsiveCarousel");this.element=this.internal.targetBackupCopy;f.Widget.prototype.destroy.call(this)},computeAdjust:function(b){var c=this.internal,d=this.options,e=b.position().left,a,g=c.unitWidth/-2,f=c.targetParentInnerWidth,h;a=c.nudgeDirection;var j=c.unitWidth;null!==a&&("left"===a&&(h=e-j),"right"===a&&(h=e+j),e=h);a=e+c.targetWidth;a<f&&(e=h=e+f-a);0<e&&(e=h=0);if("individual"===d.unitWidth)for(f=0;f<c.numUnits;f++){if(g=b.find(d.unitElement).eq(f),
Math.abs(e)>=g.data("responsiveCarousel").left&&Math.abs(e)<=g.data("responsiveCarousel").right){h=-1*g.data("responsiveCarousel").left;break}}else b=e%this.internal.unitWidth,0!==b&&(b<g&&(h=e-(this.internal.unitWidth+b)),b>g&&(h=e-b));return h}})})(jQuery,window,document);
