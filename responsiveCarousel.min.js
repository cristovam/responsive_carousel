/*!
 * responsiveCarousel
 * A responsive carousel that works in desktop browsers, ipad, iphone, and even
 * most Androids.  It uses css3 animations with a jquery animation fallback for
 * greater speed.  The code was optimized to minimize page reflows to further
 * enhance the overall speed..
 *
 * This is a jQuery UI Widget
 *
 * @version 1.6.0
 * @releaseDate 3/29/2013
 * @author Matthew Toledo
 * @url https://github.com/mrbinky3000/responsive_carousel
 * @requires jQuery, jQuery UI (only the Core and Widget Factory), modernizr (only css3 transitions test, touch test optional), hammer.js
 */
(function(d,g,q){var p=0;d.widget("ri.responsiveCarousel",{options:{arrowLeft:".arrow-left span",arrowRight:".arrow-right span",mask:".slider-mask",target:"ul",unitElement:"li",unitWidth:"inherit",responsiveUnitSize:null,onRedraw:null,ondragstart:null,ondragend:null,dragEvents:!1,easing:"linear",speed:400,slideSpeed:2500,step:-1,responsiveStep:null,onShift:null,cssAnimations:Modernizr.csstransitions,nudgeThreshold:10,infinite:!1,delta:1,dragVertical:!1,dragPreventDefault:!1,lazyload:!1},_getPrefix:function(a){for(var c=
["Moz","Webkit","Khtml","0","ms"],b=q.createElement("div"),f=a.charAt(0).toUpperCase()+a.slice(1),e="",d=c.length;-1<d;)void 0!==b.style[c[d]+f]&&(e=c[d]),d-=1;return e=b.style[a]?a.toLowerCase():"-"+e.toLowerCase()+"-"},_round:function(a){if("compute"===this.options.unitWidth||"inherit"===this.options.unitWidth||"integer"===this.options.unitWidth)a=Math.round(a/this.internal.unitWidth)*this.internal.unitWidth;return a},_animate:function(a,c,b,f){var e=this.options,h=this.internal,j=h.prefix+"transition",
l=this._round(Math.floor(a.position().left)),k=c.left,m=l+k;a.css(j,"");var n=d('<div class="redraw-'+p+'"> </div>');n.appendTo(a);n.hide();n.get(0).offsetHeight;n.show();g.setTimeout(function(){n.remove()},1);!0===e.infinite&&void 0!==k&&(k<l?(k=-1*h.unitWidth*(h.numUnits-h.numVisibleUnits),l===k&&(a.css("left",0),c.left=-h.unitWidth)):k>l&&0===l&&(k=-1*Math.floor(a.find(".clone:first").position().left),a.css("left",k),c.left=k+m));g.setTimeout(function(){e.cssAnimations?(a.css(j,"left "+b/1E3+"s "+
e.easing),a.css(c),g.setTimeout(function(){a.css(j,"");d.isFunction(f)&&f()},b)):a.animate(c,b,function(){d.isFunction(f)&&f()})},1)},_requestAnimationFrameShim:function(){var a=0,c=["ms","moz","webkit","o"];if(!g.requestAnimationFrame||!g.cancelAnimationFrame){for(var b=0;b<c.length&&!g.requestAnimationFrame;++b)g.requestAnimationFrame=g[c[b]+"RequestAnimationFrame"],g.cancelAnimationFrame=g[c[b]+"CancelAnimationFrame"]||g[c[b]+"CancelRequestAnimationFrame"];g.requestAnimationFrame||(g.requestAnimationFrame=
function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),j=g.setTimeout(function(){b(c+d)},d);a=c+d;return j});g.cancelAnimationFrame||(g.cancelAnimationFrame=function(b){clearTimeout(b)})}},_setTargetWidth:function(){var a=this.internal,c=this.options;a.numUnits=d(c.unitElement).length;"individual"===c.unitWidth?(a.targetWidth=0,d(c.unitElement).each(function(){var b=d(this),c;b.css("width","");c=Math.ceil(b.width())+1;b.width(c);a.targetWidth+=c;d(this).data("responsiveCarousel",{width:c,top:Math.floor(b.position().top),
right:Math.floor(b.position().left)+b.width(),bottom:Math.floor(b.position().top)+b.height(),left:Math.floor(b.position().left)})})):a.targetWidth=a.numUnits*a.unitWidth;d(c.target).width(a.targetWidth);a.targetHeight=d(c.target).height();a.maskWidth=d(c.mask).width();a.maskHeight=d(c.mask).height()},_setArrowVisibility:function(){var a=this.options,c=this.internal,b=d(a.target),f=d(a.arrowLeft),e=d(a.arrowRight),h=c.maskWidth,b=this._round(Math.floor(b.position().left)),j=c.targetWidth+b;e.length&&
(!0!==a.infinite&&j<=h?(e.addClass("disabled"),!0===c.isArrowBeingClicked&&this._clearInterval(),c.arrowRightVisible=c.isArrowBeingClicked=!1):!1===c.arrowRightVisible&&(e.removeClass("disabled"),c.arrowRightVisible=!0));f.length&&(!0!==a.infinite&&0<=b?(f.addClass("disabled"),!0===c.isArrowBeingClicked&&this._clearInterval(),c.arrowLeftVisible=c.isArrowBeingClicked=!1):!1===c.arrowLeftVisible&&(f.removeClass("disabled"),c.arrowLeftVisible=!0));if("individual"===a.unitWidth)for(e=0;e<c.numUnits;e++){if(f=
d(a.unitElement).eq(e),Math.abs(b)>=f.data("responsiveCarousel").left&&Math.abs(b)<f.data("responsiveCarousel").right){c.currentSlide=f.data("slide");break}}else c.currentSlide=d(a.unitElement).eq([Math.abs(b/c.unitWidth)]).data("slide");e=c.currentSlide;if(d.isFunction(a.onShift)){if("number"===typeof e)a.onShift(e)}else if(null!==a.onShift)throw Error("The onShift option must be a function or null if not in use.");!0===a.lazyload&&"number"===typeof e&&this._lazyLoad()},_clearInterval:function(){var a=
this.internal,c=this.options,b=d(c.target);"number"===typeof a.timer&&(a.isArrowBeingClicked=!1,g.clearInterval(a.timer));!1===a.busy&&(a.busy=!0,this._animate(b,{left:this.computeAdjust(b,"clearInterval")},c.speed,function(){a.busy=!1}))},_doArrowBeingClicked:function(a){var c=this,b=this.internal,f=this.options,e=d(f.target),h=Math.floor(e.position().left);if(!0!==b.busy){if("individual"===f.unitWidth)if("right"===a)a=d(f.unitElement).eq(b.currentSlide+1).length?-1*d(f.unitElement).eq(b.currentSlide+
1).data("responsiveCarousel").left:h-(b.nudgeThreshold?b.nudgeThreshold:20);else if("left"===a)a=d(f.unitElement).eq(b.currentSlide-1).length?-1*d(f.unitElement).eq(b.currentSlide-1).data("responsiveCarousel").left:h+(b.nudgeThreshold?b.nudgeThreshold:20);else throw Error("unknown direction");else if("left"===a)a=h+b.unitWidth;else if("right"===a)a=h-b.unitWidth;else throw Error("unknown direction");a=Math.floor(a);b.busy=!0;this._animate(e,{left:a},f.speed,function(){c._setArrowVisibility("_doArrowBeingClicked");
b.busy=!1})}},_setArrowEvents:function(){var a=this,c=this.options,b=this.internal,f=d(c.arrowLeft),e=d(c.arrowRight),h="",j="";f.on("click"+this.instanceId,function(b){b.preventDefault()});e.on("click"+this.instanceId,function(b){b.preventDefault()});!0===c.dragEvents?(h="mousedown"+this.instanceId+" touchstart"+this.instanceId+" gesturestart"+this.instanceId+" gesturechange"+this.instanceId,j="mouseup"+this.instanceId+" mouseout"+this.instanceId+" mouseleave"+this.instanceId+" touchend"+this.instanceId+
" touchleave"+this.instanceId+" gestureend"+this.instanceId):(h="mousedown"+this.instanceId,j="mouseup"+this.instanceId+" mouseout"+this.instanceId+" mouseleave"+this.instanceId);f.on(h,function(c){!0===b.ios6Device&&(b.busy=!1);c.preventDefault();c.stopPropagation();!1===b.busy&&!f.hasClass("disabled")&&(b.isArrowBeingClicked=b.firstMouseClick=!0,b.timer=g.setInterval(function(){a._doArrowBeingClicked("left")},10),b.slideTimer&&(g.clearInterval(b.slideTimer),b.slideShowActive=!1))});e.on(h,function(c){!0===
b.ios6Device&&(b.busy=!1);c.preventDefault();c.stopPropagation();!1===b.busy&&!e.hasClass("disabled")&&(b.isArrowBeingClicked=b.firstMouseClick=!0,b.timer=g.setInterval(function(){a._doArrowBeingClicked("right")},10),b.slideTimer&&(g.clearInterval(b.slideTimer),b.slideShowActive=!1))});d.each([f,e],function(){d(this).on(j,function(){!0===b.isArrowBeingClicked&&a._clearInterval()})});d(g).on("scroll"+this.instanceId+" resize"+this.instanceId+" onorientationchange"+this.instanceId,function(){a._clearInterval()})},
_setUnitWidth:function(){var a,c,b=this,f=this.internal,e=this.options,h=d(e.target),j=d(this.element),l=d(e.unitElement+":not(.clone)"),k=l.eq(0),m=function(){f.unitWidth=k.width()},n=function(){var b=d(e.mask).width();c=e.responsiveUnitSize(j,f,e);if("number"!==typeof c||1>c)throw Error("The responsiveUnitSize callback must return a whole number greater than 0");a=b/c;a=Math.floor(a);d(e.unitElement).css("width",a);!0===e.infinite&&(0<c&&c!==f.numVisibleUnits)&&(f.numVisibleUnits=c,h.find(".clone").remove(),
l.slice(0,f.numVisibleUnits).clone(!0).addClass("clone").appendTo(h));f.unitWidth=a;f.numVisibleUnits=c};if("inherit"===e.unitWidth)m(),h.find("img").one("load"+b.instanceId,function(){m();b._setTargetWidth("inherit");b._setArrowVisibility("_setUnitWidth inherit imageload");if(d.isFunction(e.onRedraw))e.onRedraw(j,f,e)});else if("individual"===e.unitWidth){if(d.isFunction(e.onRedraw))e.onRedraw(j,f,e);h.find("img").one("load"+b.instanceId,function(){b._setTargetWidth("individual");b._setArrowVisibility("_setUnitWidth individual imageload");
if(d.isFunction(e.onRedraw))e.onRedraw(j,f,e)});d(g).on("resize"+b.instanceId,function(){clearTimeout(f.setWidthTimer);f.setWidthTimer=setTimeout(function(){var a;b._setTargetWidth("individual (window resize)");a=-1*d(e.unitElement).eq(f.currentSlide).data("responsiveCarousel").left;h.css({left:a});b._setArrowVisibility("_setUnitWidth individual resize");if(d.isFunction(e.onRedraw))e.onRedraw(j,f,e)},400)})}else if("compute"===e.unitWidth){m();d.isFunction(e.responsiveUnitSize)&&(n(),m());if(d.isFunction(e.onRedraw))e.onRedraw(j,
f,e);h.find("img").each(function(){d(this).one("load"+b.instanceId,function(){if(!1===h.is(":hidden")&&(d.isFunction(e.responsiveUnitSize)&&n(),m(),b._setTargetWidth("compute (image load) "+b.instanceId),b._setArrowVisibility("_setUnitWidth compute imageload"),d.isFunction(e.onRedraw)))e.onRedraw(j,f,e)})});d(g).on("resize"+b.instanceId,function(){clearTimeout(f.setWidthTimer);!1===h.is(":hidden")&&(f.setWidthTimer=setTimeout(function(){var a;d.isFunction(e.responsiveUnitSize)&&(n(),m());m();b._setTargetWidth("compute (window resize) "+
b.instanceId);a=-1*f.currentSlide*f.unitWidth;a<-1*f.maskWidth&&(a=f.maskWidth-f.targetWidth);h.css({left:a});b._setArrowVisibility("_setUnitWidth compute resize");if(d.isFunction(e.onRedraw))e.onRedraw(j,f,e)},400))})}else f.unitWidth=e.unitWidth},_dragEvents:function(){var a=this,c=this.options,b=this.internal,f=d(c.target),e=d(c.mask),e=new Hammer(e.get(0),{prevent_default:c.dragPreventDefault,css_hacks:!0,drag:!0,drag_vertical:c.dragVertical,drag_horizontal:!0,drag_min_distance:0,swipe:!1,transform:!1,
tap:!1,tap_double:!1,hold:!1}),h={};b.touchObject=e;e.ondragstart=function(){(new Date).getTime();a.stopSlideShow();g.cancelAnimationFrame(b.dragTimer);if(!0===b.isArrowBeingClicked||!0===b.busy)return{};b.busy=!0===b.ios6Device?!1:!0;h={top:parseInt(f.css("top"),10),left:parseInt(f.css("left"),10)};h.time=(new Date).getTime();b.scrollStart=h;if(d.isFunction(c.ondragstart))c.ondragstart(c,b)};e.ondrag=function(a){b.dragTimer=g.requestAnimationFrame(function(){if(!0!==b.isArrowBeingClicked){var e=
c.delta,d,g,n=-1*b.unitWidth*(b.numUnits-b.numVisibleUnits);if("up"===a.direction||"left"===a.direction)a.distance*=-1;d=h.left+a.distance*e;g=Math.abs(b.scrollStart.left-d);b.nudgeDirection=g>c.nudgeThreshold&&g<b.unitWidth/2?"up"===a.direction||"left"===a.direction?"left":"right":g<=c.nudgeThreshold?"abort":null;!0===c.infinite&&(d<=n&&(d=0+a.distance*e,b.scrollStart.left=0),0<=d&&(d=n+a.distance*e,b.scrollStart.left=n));b.left=d;f.css("left",d)}})};e.ondragend=function(){g.cancelAnimationFrame(b.dragTimer);
f.stop(!0,!1);(new Date).getTime();a._animate(f,{left:a.computeAdjust(f,"dragend")},c.speed,function(){a._setArrowVisibility("ondragend");b.busy=!1;if(d.isFunction(c.ondragend))c.ondragend(c,b)})}},_create:function(){p+=1;var a=this.options,c=d(this.element),b=d(a.target);this.instanceId=".carousel_"+p.toString(10);this.internal={busy:!1,currentSlide:0,left:0,targetWidth:0,targetHeight:0,maskWidth:0,maskHeight:0,unitWidth:0,targetBackupCopy:null,isArrowBeingClicked:!1,arrowLeftVisible:!0,arrowRightVisible:!0,
targetLeft:0,timer:null,dragTimer:null,firstMouseClick:!1,prefix:null,slideShowActive:!1,slideTimer:null,slideBumped:!1,nudgeDirection:null,infinite:!1,numUnits:null,numVisibleUnits:null,scrollStart:0,touchObject:null,setWidthTimer:null,ios6Device:!1};this.internal.backup=b.clone(!0,!0);this.options.cssAnimations&&(this.internal.prefix=this._getPrefix("transition"));/(iPhone|iPod|iPad)/i.test(navigator.userAgent)&&/OS 6_/i.test(navigator.userAgent)&&(this.internal.ios6Device=!0);this._requestAnimationFrameShim();
b.css({position:"relative",left:0});b.addClass("instance-"+p);d(a.unitElement).each(function(a){d(this).attr({"data-slide":a})});!0===a.dragEvents&&this._dragEvents();this._setArrowEvents();b.not(":hidden")&&(this._setUnitWidth(),this._setTargetWidth("first load"),this._setArrowVisibility("_create"),this._lazyLoad());if(d.isFunction(a.onRedraw))a.onRedraw(c,this.internal,a);!0===a.lazyload&&d(a.target).find("img.lazy-slider").lazyload({effect:"fadeIn",skip_invisible:!1})},_lazyLoad:function(){for(var a=
this.internal,c=d(this.options.unitElement),b=a.currentSlide+a.numVisibleUnits,a=a.currentSlide;a<b;a++)c.eq(a).find("img.lazy-slider").trigger("appear")},redraw:function(){var a=this.internal,c=this.options,b=d(this.element);if(d(c.target).not(":hidden")&&(void 0===this.unitWidth&&this._setUnitWidth(),this._setTargetWidth("_redraw (manually called) "+this.instanceId),this._setArrowVisibility("forced redraw"),d.isFunction(this.options.onRedraw)))this.options.onRedraw(b,a,c)},getCurrentSlide:function(){return this.internal.currentSlide},
goToSlide:function(a,c){var b=this,f=this.internal,e=this.options,h=d(e.target),g;c=void 0!==c?c:!0;h.not(":hidden")&&(void 0===this.unitWidth&&this._setUnitWidth(),g="individual"===e.unitWidth?d(e.unitElement).eq(a).data("responsiveCarousel").left:-1*a*f.unitWidth,f.busy=!0,!0===c?this._animate(h,{left:g},e.speed,function(){f.busy=!1;b._setArrowVisibility("goto slide")}):h.css("left",g))},toggleSlideShow:function(){!1===this.internal.slideShowActive?this.startSlideShow():this.stopSlideShow()},_step:function(a){var c=
this,b=this.internal,f=this.options,e=d(f.target),h=b.maskWidth,g=this._round(Math.floor(e.position().left)),l=g+a*b.unitWidth,k=g+b.targetWidth;a=k+a*b.unitWidth;var m=l;!1===b.slideBumped?!1===f.infinite&&(a<=h&&(m=l+h-a,b.slideBumped="left"),0<=l&&(b.slideBumped="right",m=0)):("left"===b.slideBumped&&(m=0),"right"===b.slideBumped&&(m=g+h-k),b.slideBumped=!1);b.busy=!0;this._animate(e,{left:m},f.speed,function(){b.busy=!1;c._setArrowVisibility("_step")})},startSlideShow:function(){var a=this,c=
this.internal,b=this.options;!1===c.slideShowActive&&(c.slideShowActive=!0,c.slideTimer=g.setInterval(function(){a._step(b.step)},b.slideSpeed))},stopSlideShow:function(){var a=this.internal;!0===a.slideShowActive&&(a.slideShowActive=!1,g.clearInterval(a.slideTimer))},_destroy:function(){var a=d(this.options.target),c=d(this.options.mask);g.clearTimeout(this.internal.setWidthTimer);g.clearInterval(this.internal.slideTimer);d(g).unbind(this.instanceId);d(q).unbind(this.instanceId);d(this.options.arrowLeft).unbind(this.instanceId);
d(this.options.arrowRight).unbind(this.instanceId);a.removeClass("instance-"+p);a.find("img").unbind(this.instanceId);null!==this.internal.touchObject&&this.internal.touchObject.destroy();c.css({"-webkit-user-select":"","-webkit-user-drag":"","-webkit-tap-highlight-color":""});a.replaceWith(this.internal.backup)},computeAdjust:function(a){var c=this.internal,b=this.options,f=c.scrollStart.left;a=a.position().left;var e=c.maskWidth,h=0,g=c.nudgeDirection,l=c.unitWidth,k=!1;null!==g&&("left"===g&&(h=
f-l),"right"===g&&(h=f+l),"abort"===g&&(h=a),a=h,c.nudgeDirection=null);f=a+c.targetWidth;f<e&&(a=h=a+e-f,k=!0);0<a&&(a=h=0);if("individual"===b.unitWidth)for(g=0;g<c.numUnits;g++)if(f=d(b.unitElement).eq(g),!0==k)c.targetWidth>e&&(h=c.maskWidth-c.targetWidth);else{if(Math.abs(a)>=f.data("responsiveCarousel").left&&Math.abs(a)<=f.data("responsiveCarousel").right){h=-1*f.data("responsiveCarousel").left;break}}else h=this._round(a);!0===isNaN(h)&&(h=0);return h},getNumVisibleUnits:function(){return this.internal.numVisibleUnits}})})(jQuery,
window,document);
