/*!
 * responsiveCarousel
 * A responsive carousel that works in desktop browsers, ipad, iphone, and even
 * most Androids.  It uses css3 animations with a jquery animation fallback for
 * greater speed.  The code was optimized to minimize page reflows to further
 * enhance the overall speed.  Doesn't try and solve everything, small and
 * compact for specific use..
 *
 * This is a jQuery UI Widget
 *
 * @version 0.4.0
 * @releaseDate 1/10/2013
 * @author Matthew Toledo
 * @url https://github.com/mrbinky3000/responsive_carousel
 * @requires jQuery, jQuery UI (only the Core and Widget Factory), modernizr (only css3 transitions test, touch test optional), hammer.js
 */
(function(f,k,r){var j=!1;f.widget("ri.responsiveCarousel",{options:{arrowLeft:".arrow-left a",arrowRight:".arrow-right a",target:".slider-target",mask:".slider-mask",unitElement:"li",unitWidth:"inherit",responsiveUnitSize:null,onRedraw:null,dragEvents:!1,speed:400,slideSpeed:2500,step:-1,responsiveStep:null,onShift:null,cssAnimations:Modernizr.csstransitions,nudgeThreshold:10,infinite:!1},internal:{currentSlide:0,left:0,targetWidth:0,unitWidth:0,targetOuterWidth:0,targetOuterHeight:0,targetParentOuterWidth:0,
targetParentInnerWidth:0,targetParentOuterHeight:0,targetParentMarginLeft:0,targetBackupCopy:null,isArrowBeingClicked:!1,arrowLeftVisible:!0,arrowRightVisible:!0,targetLeft:0,timer:null,firstMouseClick:!1,prefix:null,slideShowActive:!1,slideTimer:null,slideBumped:!1,nudgeDirection:null,infinite:!1,numUnits:0,numVisibleUnits:0},wait:function(){var a;return{thenDo:function(b,d){void 0!==a&&k.clearTimeout(a);a=k.setTimeout(b,d)}}},_getPrefix:function(a){for(var b=["Moz","Webkit","Khtml","0","ms"],d=
r.createElement("div"),e=a.charAt(0).toUpperCase()+a.slice(1),c="",g=b.length;-1<g;)void 0!==d.style[b[g]+e]&&(c=b[g]),g-=1;return c=d.style[a]?a.toLowerCase():"-"+c.toLowerCase()+"-"},_animate:function(a,b,d,e){var c=this.options,g=this.internal,h=g.prefix+"transition",m=a.position().left,l=b.left,j=m+l;!0===c.infinite&&void 0!==l&&(l<m?(l=-1*g.unitWidth*(g.numUnits-g.numVisibleUnits),m===l&&(a.css({transition:"",left:0}),b.left=-g.unitWidth)):l>m&&0===m&&(l=-1*a.find(".clone:first").position().left,
a.css({transition:"",left:l}),b.left=l+j));k.setTimeout(function(){c.cssAnimations?(a.css(h,"all "+d/1E3+"s ease-in-out").css(b),k.setTimeout(function(){a.css(h,"");f.isFunction(e)&&e()},d)):a.animate(b,d,function(){f.isFunction(e)&&e()})},1)},_setTargetWidth:function(){var a=this.internal,b=this.options,d=f(this.element),e=f(this.element).find(b.target);a.numUnits=e.find(b.unitElement).length;a.targetWidth=a.numUnits*a.unitWidth;d.find(b.target).width(a.targetWidth);a.targetOuterWidth=e.outerWidth();
a.targetOuterHeight=e.outerHeight();a.targetParentOuterWidth=e.parent().outerWidth();a.targetParentInnerWidth=e.parent().innerWidth();a.targetParentOuterHeight=e.parent().outerHeight();a.targetParentMarginLeft=parseInt(e.parents().css("marginLeft"),10);isNaN(a.targetParentMarginLeft)&&(a.targetParentMarginLeft=0)},_setArrowVisibility:function(){var a=this.options,b=this.internal,d=f(this.element).find(a.target),e=d.position().left,c=b.targetOuterWidth+e,g=f(this.element).find(a.arrowLeft),h=f(this.element).find(a.arrowRight),
m=b.targetParentOuterWidth;!0!==a.infinite&&c<=m?(h.hide(),!0===b.isArrowBeingClicked&&this._clearInterval(),b.arrowRightVisible=b.isArrowBeingClicked=!1):!1===b.arrowRightVisible&&(h.show(),b.arrowRightVisible=!0);!0!==a.infinite&&0<=e?(g.hide(),!0===b.isArrowBeingClicked&&this._clearInterval(),b.arrowLeftVisible=b.isArrowBeingClicked=!1):!1===b.arrowLeftVisible&&(g.show(),b.arrowLeftVisible=!0);b.currentSlide=f(d.find(a.unitElement)[Math.abs(e/b.unitWidth)]).data("slide");if(f.isFunction(a.onShift))a.onShift(b.currentSlide)},
_clearInterval:function(){var a=this.internal,b=this.options,d=f(this.element).find(b.target);"number"===typeof a.timer&&(a.isArrowBeingClicked=!1,k.clearInterval(a.timer));!1===j&&(j=!0,this._animate(d,{left:this.computeAdjust(d)},b.speed,function(){j=!1}))},_doArrowBeingClicked:function(a){var b=this,d=this.internal,e=this.options,c=f(this.element).find(e.target),g=c.position().left,h=d.targetParentMarginLeft;if(!0!==j){if("left"===a)a=g-h+d.unitWidth;else if("right"===a)a=g-h-d.unitWidth;else throw Error("unknown direction");
j=!0;this._animate(c,{left:a},e.speed,function(){b._setArrowVisibility();j=!1})}},_setArrowEvents:function(){var a=this,b=this.options,d=this.internal,e=f(this.element).find(b.arrowLeft),c=f(this.element).find(b.arrowRight),g="",h="";e.on("click.responsiveCarousel",function(b){b.preventDefault()});c.on("click.responsiveCarousel",function(b){b.preventDefault()});!0===b.dragEvents?(g="mousedown.responsiveCarousel touchstart.responsiveCarousel",h="mouseup.responsiveCarousel touchend.responsiveCarousel"):
(g="mousedown.responsiveCarousel",h="mouseup.responsiveCarousel");e.on(g,function(b){b.preventDefault();!1===j&&(d.isArrowBeingClicked=d.firstMouseClick=!0,d.timer=k.setInterval(function(){a._doArrowBeingClicked("left")},10),d.slideTimer&&(k.clearInterval(d.slideTimer),d.slideShowActive=!1))});c.on(g,function(){!1===j&&(d.isArrowBeingClicked=d.firstMouseClick=!0,d.timer=k.setInterval(function(){a._doArrowBeingClicked("right")},10),d.slideTimer&&(k.clearInterval(d.slideTimer),d.slideShowActive=!1))});
f(this.element).on(h,function(){!0===d.isArrowBeingClicked&&a._clearInterval()})},_setUnitWidth:function(){var a,b,d=this,e=this.internal,c=this.options,g=f(this.element).find(c.target),h=f(this.element),m=g.find(c.unitElement+":not(.clone)"),l=m.eq(0),j=new this.wait,n=function(){e.unitWidth=l.outerWidth()},q=function(){var d=h.find(c.mask).innerWidth(),f=null;b=c.responsiveUnitSize(h,e,c);if("number"!==typeof b||1>b)throw Error("The responsiveUnitSize callback must return a whole number greater than 0");
a=d/b;a=Math.floor(a);g.find(c.unitElement).css("width",a);e.unitWidth=a;e.numVisibleUnits=b;!0===c.infinite&&1<b&&(f=b,g.find(".clone").remove(),m.slice(0,f).clone(!0).addClass("clone").appendTo(g))};if("inherit"===c.unitWidth)n(),g.find("img").on("load.responsiveCarousel",function(){n();d._setTargetWidth("inherit");d._setArrowVisibility();if(f.isFunction(c.onRedraw))c.onRedraw(h,e,c)});else if("compute"===c.unitWidth){n();f.isFunction(c.responsiveUnitSize)&&(q(),n());if(f.isFunction(c.onRedraw))c.onRedraw(h,
e,c);g.find("img").on("load",function(){f.isFunction(c.responsiveUnitSize)&&q();n();d._setTargetWidth("compute");d._setArrowVisibility();if(f.isFunction(c.onRedraw))c.onRedraw(h,e,c)});f(k).on("resize.responsiveCarousel",function(){j.thenDo(function(){f.isFunction(c.responsiveUnitSize)&&q();n();d._setTargetWidth("compute (window resize)");g.css({left:-1*e.currentSlide*e.unitWidth});d._setArrowVisibility();if(f.isFunction(c.onRedraw))c.onRedraw(h,e,c)},100)})}else e.unitWidth=c.unitWidth},_dragEvents:function(){var a=
this,b=this.options,d=this.internal,e=f(this.element).find(b.target),c=e.parent(),c=new Hammer(c.get(0),{drag:!0,drag_vertical:!1,drag_horizontal:!0,drag_min_distance:0,transform:!1,tap:!1,tap_double:!1,hold:!1}),g;c.ondragstart=function(){if(!0===d.isArrowBeingClicked||!0===j)return{};j=!0;parseInt(e.css("top"),10);g=parseInt(e.css("left"),10);(new Date).getTime()};c.ondrag=function(a){if(!0!==d.isArrowBeingClicked){var c,f=-1*d.unitWidth*(d.numUnits-d.numVisibleUnits);d.nudgeDirection=null;"up"===
a.direction||"left"===a.direction?(a.distance=-a.distance,Math.abs(a.distance)>b.nudgeThreshold&&Math.abs(a.distance)<d.unitWidth/2&&(d.nudgeDirection="left")):a.distance>b.nudgeThreshold&&a.distance<d.unitWidth/2&&(d.nudgeDirection="right");c=g+3*a.distance;!0===b.infinite&&(c<=f&&(c=0+3*a.distance),0<=c&&(c=f+3*a.distance));d.left=c;e.css("left",c)}};c.ondragend=function(){e.stop(!0,!1);a._animate(e,{left:a.computeAdjust(e)},b.speed,function(){a._setArrowVisibility();j=!1})}},_create:function(){var a=
this.options,b=this.internal,d=f(this.element),e=f(this.element).find(a.target);this.internal.targetBackupCopy=this.element;this.options.cssAnimations&&(this.internal.prefix=this._getPrefix("transition"));e.css({position:"relative",left:0});e.find(a.unitElement).each(function(a){f(this).attr({"data-slide":a})});!0===a.dragEvents&&this._dragEvents();this._setArrowEvents();this._setUnitWidth();this._setTargetWidth("first load");this._setArrowVisibility();if(f.isFunction(a.onRedraw))a.onRedraw(d,b,a)},
redraw:function(){var a=this.internal,b=this.options,d=f(this.element);this._setUnitWidth();this._setTargetWidth("_redraw");this._setArrowVisibility();if(f.isFunction(this.options.onRedraw))this.options.onRedraw(d,a,b)},getCurrentSlide:function(){return this.internal.currentSlide},goToSlide:function(a,b){var d=this,e=this.internal,c=this.options,g=f(this.element).find(c.target);b=void 0!==b?b:!0;this._setUnitWidth();e=-1*a*e.unitWidth;j=!0;!0===b?this._animate(g,{left:e},c.speed,function(){j=!1;d._setArrowVisibility()}):
g.css("left",e)},toggleSlideShow:function(){var a=this,b=this.internal,d=this.options,e=f(this.element).find(d.target);!1===b.slideShowActive?(b.slideShowActive=!0,b.slideTimer=k.setInterval(function(){var c=d.step,f=b.targetParentInnerWidth,h=e.position().left,k=h+b.targetWidth,l=h+c*b.unitWidth,c=k+c*b.unitWidth,p=l;!1===b.slideBumped?!1===d.infinite&&(c<=f&&(p=l+f-c,b.slideBumped="left"),0<=l&&(b.slideBumped="right",p=0)):("left"===b.slideBumped&&(p=0),"right"===b.slideBumped&&(p=h+f-k),b.slideBumped=
!1);j=!0;a._animate(e,{left:p},d.speed,function(){j=!1;a._setArrowVisibility()})},d.slideSpeed)):!0===b.slideShowActive&&(b.slideShowActive=!1,k.clearInterval(b.slideTimer))},destroy:function(){f(k).unbind(".responsiveCarousel");f(this.element).find(this.options.arrowLeft).unbind(".responsiveCarousel");f(this.element).find(this.options.arrowRight).unbind(".responsiveCarousel");this.element=this.internal.targetBackupCopy;f.Widget.prototype.destroy.call(this)},computeAdjust:function(a){var b=this.internal;
a=a.position().left;var d=b.unitWidth/-2,e=b.targetParentInnerWidth,c,f=b.nudgeDirection,h=b.unitWidth;null!==f&&("left"===f&&(c=a-h),"right"===f&&(c=a+h),a=c);b=a+b.targetWidth;b<e&&(a=c=a+e-b);0<a&&(a=c=0);b=a%this.internal.unitWidth;0!==b&&(b<d&&(c=a-(this.internal.unitWidth+b)),b>d&&(c=a-b));return c}})})(jQuery,window,document);
