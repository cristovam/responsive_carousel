/*!
 * responsiveCarousel
 * A responsive carousel that works in desktop browsers, ipad, iphone, and even
 * most Androids.  It uses css3 animations with a jquery animation fallback for
 * greater speed.  The code was optimized to minimize page reflows to further
 * enhance the overall speed.  Doesn't try and solve everything, small and
 * compact for specific use..
 *
 * This is a jQuery UI Widget
 *
 * @version 0.4.0
 * @releaseDate 1/10/2013
 * @author Matthew Toledo
 * @url https://github.com/mrbinky3000/responsive_carousel
 * @requires jQuery, jQuery UI (only the Core and Widget Factory), modernizr (only css3 transitions test, touch test optional), hammer.js
 */
(function(f,h,r){var k=!1;f.widget("ri.responsiveCarousel",{options:{arrowLeft:".arrow-left span",arrowRight:".arrow-right span",target:".slider-target",mask:".slider-mask",unitElement:"li",unitWidth:"inherit",responsiveUnitSize:null,onRedraw:null,dragEvents:!1,speed:400,slideSpeed:2500,step:-1,responsiveStep:null,onShift:null,cssAnimations:Modernizr.csstransitions,nudgeThreshold:10,infinite:!1},internal:{currentSlide:0,left:0,targetWidth:0,unitWidth:0,targetOuterWidth:0,targetOuterHeight:0,targetParentOuterWidth:0,
targetParentInnerWidth:0,targetParentOuterHeight:0,targetParentMarginLeft:0,targetBackupCopy:null,isArrowBeingClicked:!1,arrowLeftVisible:!0,arrowRightVisible:!0,targetLeft:0,timer:null,firstMouseClick:!1,prefix:null,slideShowActive:!1,slideTimer:null,slideBumped:!1,nudgeDirection:null,infinite:!1,numUnits:0,numVisibleUnits:0},wait:function(){var b;return{thenDo:function(a,c){void 0!==b&&h.clearTimeout(b);b=h.setTimeout(a,c)}}},_getPrefix:function(b){for(var a=["Moz","Webkit","Khtml","0","ms"],c=
r.createElement("div"),e=b.charAt(0).toUpperCase()+b.slice(1),d="",g=a.length;-1<g;)void 0!==c.style[a[g]+e]&&(d=a[g]),g-=1;return d=c.style[b]?b.toLowerCase():"-"+d.toLowerCase()+"-"},_animate:function(b,a,c,e){var d=this.options,g=this.internal,j=g.prefix+"transition",m=b.position().left,l=a.left,k=m+l;!0===d.infinite&&void 0!==l&&(l<m?(l=-1*g.unitWidth*(g.numUnits-g.numVisibleUnits),m===l&&(b.css({transition:"",left:0}),a.left=-g.unitWidth)):l>m&&0===m&&(l=-1*b.find(".clone:first").position().left,
b.css({transition:"",left:l}),a.left=l+k));h.setTimeout(function(){d.cssAnimations?(b.css(j,"all "+c/1E3+"s ease-in-out").css(a),h.setTimeout(function(){b.css(j,"");f.isFunction(e)&&e()},c)):b.animate(a,c,function(){f.isFunction(e)&&e()})},1)},_setTargetWidth:function(){var b=this.internal,a=this.options,c=f(this.element),e=f(this.element).find(a.target);b.numUnits=e.find(a.unitElement).length;b.targetWidth=b.numUnits*b.unitWidth;c.find(a.target).width(b.targetWidth);b.targetOuterWidth=e.outerWidth();
b.targetOuterHeight=e.outerHeight();b.targetParentOuterWidth=e.parent().outerWidth();b.targetParentInnerWidth=e.parent().innerWidth();b.targetParentOuterHeight=e.parent().outerHeight();b.targetParentMarginLeft=parseInt(e.parents().css("marginLeft"),10);isNaN(b.targetParentMarginLeft)&&(b.targetParentMarginLeft=0)},_setArrowVisibility:function(){var b=this.options,a=this.internal,c=f(this.element).find(b.target),e=c.position().left,d=a.targetOuterWidth+e,g=f(this.element).find(b.arrowLeft),j=f(this.element).find(b.arrowRight),
m=a.targetParentOuterWidth;!0!==b.infinite&&d<=m?(j.addClass("disabled"),!0===a.isArrowBeingClicked&&this._clearInterval(),a.arrowRightVisible=a.isArrowBeingClicked=!1):!1===a.arrowRightVisible&&(j.removeClass("disabled"),a.arrowRightVisible=!0);!0!==b.infinite&&0<=e?(g.addClass("disabled"),!0===a.isArrowBeingClicked&&this._clearInterval(),a.arrowLeftVisible=a.isArrowBeingClicked=!1):!1===a.arrowLeftVisible&&(g.removeClass("disabled"),a.arrowLeftVisible=!0);a.currentSlide=f(c.find(b.unitElement)[Math.abs(e/
a.unitWidth)]).data("slide");if(f.isFunction(b.onShift))b.onShift(a.currentSlide)},_clearInterval:function(){var b=this.internal,a=this.options,c=f(this.element).find(a.target);"number"===typeof b.timer&&(b.isArrowBeingClicked=!1,h.clearInterval(b.timer));!1===k&&(k=!0,this._animate(c,{left:this.computeAdjust(c)},a.speed,function(){k=!1}))},_doArrowBeingClicked:function(b){var a=this,c=this.internal,e=this.options,d=f(this.element).find(e.target),g=d.position().left,j=c.targetParentMarginLeft;if(!0!==
k){if("left"===b)b=g-j+c.unitWidth;else if("right"===b)b=g-j-c.unitWidth;else throw Error("unknown direction");k=!0;this._animate(d,{left:b},e.speed,function(){a._setArrowVisibility();k=!1})}},_setArrowEvents:function(){var b=this,a=this.options,c=this.internal,e=f(this.element).find(a.arrowLeft),d=f(this.element).find(a.arrowRight),g="",j="";e.on("click.responsiveCarousel",function(a){a.preventDefault()});d.on("click.responsiveCarousel",function(a){a.preventDefault()});!0===a.dragEvents?(g="mousedown.responsiveCarousel touchstart.responsiveCarousel",
j="mouseup.responsiveCarousel touchend.responsiveCarousel"):(g="mousedown.responsiveCarousel",j="mouseup.responsiveCarousel");e.on(g,function(a){a.preventDefault();!1===k&&!e.hasClass("disabled")&&(c.isArrowBeingClicked=c.firstMouseClick=!0,c.timer=h.setInterval(function(){b._doArrowBeingClicked("left")},10),c.slideTimer&&(h.clearInterval(c.slideTimer),c.slideShowActive=!1))});d.on(g,function(){!1===k&&!d.hasClass("disabled")&&(c.isArrowBeingClicked=c.firstMouseClick=!0,c.timer=h.setInterval(function(){b._doArrowBeingClicked("right")},
10),c.slideTimer&&(h.clearInterval(c.slideTimer),c.slideShowActive=!1))});f(this.element).on(j,function(){!0===c.isArrowBeingClicked&&b._clearInterval()})},_setUnitWidth:function(){var b,a,c=this,e=this.internal,d=this.options,g=f(this.element).find(d.target),j=f(this.element),m=g.find(d.unitElement+":not(.clone)"),l=m.eq(0),k=new this.wait,n=function(){e.unitWidth=l.outerWidth()},q=function(){var c=j.find(d.mask).innerWidth(),f=null;a=d.responsiveUnitSize(j,e,d);if("number"!==typeof a||1>a)throw Error("The responsiveUnitSize callback must return a whole number greater than 0");
b=c/a;b=Math.floor(b);g.find(d.unitElement).css("width",b);e.unitWidth=b;e.numVisibleUnits=a;!0===d.infinite&&1<a&&(f=a,g.find(".clone").remove(),m.slice(0,f).clone(!0).addClass("clone").appendTo(g))};if("inherit"===d.unitWidth)n(),g.find("img").on("load.responsiveCarousel",function(){n();c._setTargetWidth("inherit");c._setArrowVisibility();if(f.isFunction(d.onRedraw))d.onRedraw(j,e,d)});else if("compute"===d.unitWidth){n();f.isFunction(d.responsiveUnitSize)&&(q(),n());if(f.isFunction(d.onRedraw))d.onRedraw(j,
e,d);g.find("img").on("load",function(){f.isFunction(d.responsiveUnitSize)&&q();n();c._setTargetWidth("compute");c._setArrowVisibility();if(f.isFunction(d.onRedraw))d.onRedraw(j,e,d)});f(h).on("resize.responsiveCarousel",function(){k.thenDo(function(){f.isFunction(d.responsiveUnitSize)&&q();n();c._setTargetWidth("compute (window resize)");g.css({left:-1*e.currentSlide*e.unitWidth});c._setArrowVisibility();if(f.isFunction(d.onRedraw))d.onRedraw(j,e,d)},100)})}else e.unitWidth=d.unitWidth},_dragEvents:function(){var b=
this,a=this.options,c=this.internal,e=f(this.element).find(a.target),d=e.parent(),d=new Hammer(d.get(0),{drag:!0,drag_vertical:!1,drag_horizontal:!0,drag_min_distance:0,transform:!1,tap:!1,tap_double:!1,hold:!1}),g;d.ondragstart=function(){if(!0===c.isArrowBeingClicked||!0===k)return{};k=!0;parseInt(e.css("top"),10);g=parseInt(e.css("left"),10);(new Date).getTime()};d.ondrag=function(b){if(!0!==c.isArrowBeingClicked){var d,f=-1*c.unitWidth*(c.numUnits-c.numVisibleUnits);c.nudgeDirection=null;"up"===
b.direction||"left"===b.direction?(b.distance=-b.distance,Math.abs(b.distance)>a.nudgeThreshold&&Math.abs(b.distance)<c.unitWidth/2&&(c.nudgeDirection="left")):b.distance>a.nudgeThreshold&&b.distance<c.unitWidth/2&&(c.nudgeDirection="right");d=g+3*b.distance;!0===a.infinite&&(d<=f&&(d=0+3*b.distance),0<=d&&(d=f+3*b.distance));c.left=d;e.css("left",d)}};d.ondragend=function(){e.stop(!0,!1);b._animate(e,{left:b.computeAdjust(e)},a.speed,function(){b._setArrowVisibility();k=!1})}},_initAnimationFrame:function(){for(var b=
0,a=["ms","moz","webkit","o"],c=0;c<a.length&&!h.requestAnimationFrame;++c)h.requestAnimationFrame=h[a[c]+"RequestAnimationFrame"],h.cancelAnimationFrame=h[a[c]+"CancelAnimationFrame"]||h[a[c]+"CancelRequestAnimationFrame"];h.requestAnimationFrame||(h.requestAnimationFrame=function(a){var d=(new Date).getTime(),c=Math.max(0,16-(d-b)),f=h.setTimeout(function(){a(d+c)},c);b=d+c;return f});h.cancelAnimationFrame||(h.cancelAnimationFrame=function(a){clearTimeout(a)})},_create:function(){var b=this.options,
a=this.internal,c=f(this.element),e=f(this.element).find(b.target);this._initAnimationFrame();this.internal.targetBackupCopy=this.element;this.options.cssAnimations&&(this.internal.prefix=this._getPrefix("transition"));e.css({position:"relative",left:0});e.find(b.unitElement).each(function(a){f(this).attr({"data-slide":a})});!0===b.dragEvents&&this._dragEvents();this._setArrowEvents();this._setUnitWidth();this._setTargetWidth("first load");this._setArrowVisibility();if(f.isFunction(b.onRedraw))b.onRedraw(c,
a,b)},redraw:function(){var b=this.internal,a=this.options,c=f(this.element);this._setUnitWidth();this._setTargetWidth("_redraw");this._setArrowVisibility();if(f.isFunction(this.options.onRedraw))this.options.onRedraw(c,b,a)},getCurrentSlide:function(){return this.internal.currentSlide},goToSlide:function(b,a){var c=this,e=this.internal,d=this.options,g=f(this.element).find(d.target);a=void 0!==a?a:!0;this._setUnitWidth();e=-1*b*e.unitWidth;k=!0;!0===a?this._animate(g,{left:e},d.speed,function(){k=
!1;c._setArrowVisibility()}):g.css("left",e)},toggleSlideShow:function(){var b=this,a=this.internal,c=this.options,e=f(this.element).find(c.target);!1===a.slideShowActive?(a.slideShowActive=!0,a.slideTimer=h.setInterval(function(){var d=c.step,f=a.targetParentInnerWidth,j=e.position().left,h=j+a.targetWidth,l=j+d*a.unitWidth,d=h+d*a.unitWidth,p=l;!1===a.slideBumped?!1===c.infinite&&(d<=f&&(p=l+f-d,a.slideBumped="left"),0<=l&&(a.slideBumped="right",p=0)):("left"===a.slideBumped&&(p=0),"right"===a.slideBumped&&
(p=j+f-h),a.slideBumped=!1);k=!0;b._animate(e,{left:p},c.speed,function(){k=!1;b._setArrowVisibility()})},c.slideSpeed)):!0===a.slideShowActive&&(a.slideShowActive=!1,h.clearInterval(a.slideTimer))},destroy:function(){f(h).unbind(".responsiveCarousel");f(this.element).find(this.options.arrowLeft).unbind(".responsiveCarousel");f(this.element).find(this.options.arrowRight).unbind(".responsiveCarousel");this.element=this.internal.targetBackupCopy;f.Widget.prototype.destroy.call(this)},computeAdjust:function(b){var a=
this.internal;b=b.position().left;var c=a.unitWidth/-2,e=a.targetParentInnerWidth,d,f=a.nudgeDirection,h=a.unitWidth;null!==f&&("left"===f&&(d=b-h),"right"===f&&(d=b+h),b=d);a=b+a.targetWidth;a<e&&(b=d=b+e-a);0<b&&(b=d=0);a=b%this.internal.unitWidth;0!==a&&(a<c&&(d=b-(this.internal.unitWidth+a)),a>c&&(d=b-a));return d}})})(jQuery,window,document);
