/*!
 * responsiveCarousel
 * A responsive carousel that works in desktop browsers, ipad, iphone, and even
 * most Androids.  It uses css3 animations with a jquery animation fallback for
 * greater speed.  The code was optimized to minimize page reflows to further
 * enhance the overall speed.  Doesn't try and solve everything, small and
 * compact for specific use..
 *
 * This is a jQuery UI Widget
 *
 * @version 0.6.0
 * @releaseDate 1/17/2013
 * @author Matthew Toledo
 * @url https://github.com/mrbinky3000/responsive_carousel
 * @requires jQuery, jQuery UI (only the Core and Widget Factory), modernizr (only css3 transitions test, touch test optional), hammer.js
 */
(function(d,j,r){var n=0;d.widget("ri.responsiveCarousel",{options:{arrowLeft:".arrow-left span",arrowRight:".arrow-right span",mask:".slider-mask",target:"ul",unitElement:"li",unitWidth:"inherit",responsiveUnitSize:null,onRedraw:null,ondragstart:null,ondragend:null,dragEvents:!1,easing:"linear",speed:400,slideSpeed:2500,step:-1,responsiveStep:null,onShift:null,cssAnimations:Modernizr.csstransitions,nudgeThreshold:10,infinite:!1,delta:1},_getPrefix:function(a){for(var c=["Moz","Webkit","Khtml","0",
"ms"],b=r.createElement("div"),f=a.charAt(0).toUpperCase()+a.slice(1),e="",d=c.length;-1<d;)void 0!==b.style[c[d]+f]&&(e=c[d]),d-=1;return e=b.style[a]?a.toLowerCase():"-"+e.toLowerCase()+"-"},_round:function(a){if("compute"===this.options.unitWidth||"inherit"===this.options.unitWidth||"integer"===this.options.unitWidth)a=Math.round(a/this.internal.unitWidth)*this.internal.unitWidth;return a},_animate:function(a,c,b,f){var e=this.options,h=this.internal,g=this._round(Math.floor(a.position().left)),
k=c.left,p=g+k;!0===e.infinite&&void 0!==k&&(k<g?(k=-1*h.unitWidth*(h.numUnits-h.numVisibleUnits),g===k&&(a.css({transition:"",left:0}),c.left=-h.unitWidth)):k>g&&0===g&&(k=-1*Math.floor(a.find(".clone:first").position().left),a.css({transition:"",left:k}),c.left=k+p));j.setTimeout(function(){if(e.cssAnimations){var g=d.extend({transition:"left "+b/1E3+"s "+e.easing},c);a.css(g);j.setTimeout(function(){a.css({transition:""});d.isFunction(f)&&f()},b)}else a.animate(c,b,function(){d.isFunction(f)&&
f()})},1)},_setTargetWidth:function(){var a=this.internal,c=this.options;d(this.element);d(c.target);a.numUnits=d(c.unitElement).length;"individual"===c.unitWidth?(a.targetWidth=0,d(c.unitElement).each(function(){var b=d(this),c=0;b.css("width","");c=Math.ceil(b.width())+1;b.width(c);a.targetWidth+=c;d(this).data("responsiveCarousel",{width:c,top:Math.floor(b.position().top),right:Math.floor(b.position().left)+b.width(),bottom:Math.floor(b.position().top)+b.height(),left:Math.floor(b.position().left)})})):
a.targetWidth=a.numUnits*a.unitWidth;d(c.target).width(a.targetWidth);a.targetHeight=d(c.target).height();a.maskWidth=d(c.mask).width();a.maskHeight=d(c.mask).height()},_setArrowVisibility:function(){var a=this.options,c=this.internal,b=d(a.target),f=d(a.arrowLeft),e=d(a.arrowRight),h=c.maskWidth,b=this._round(Math.floor(b.position().left)),g=c.targetWidth+b;e.length&&(!0!==a.infinite&&g<=h?(e.addClass("disabled"),!0===c.isArrowBeingClicked&&this._clearInterval(),c.arrowRightVisible=c.isArrowBeingClicked=
!1):!1===c.arrowRightVisible&&(e.removeClass("disabled"),c.arrowRightVisible=!0));f.length&&(!0!==a.infinite&&0<=b?(f.addClass("disabled"),!0===c.isArrowBeingClicked&&this._clearInterval(),c.arrowLeftVisible=c.isArrowBeingClicked=!1):!1===c.arrowLeftVisible&&(f.removeClass("disabled"),c.arrowLeftVisible=!0));if("individual"===a.unitWidth)for(e=0;e<c.numUnits;e++){if(f=d(a.unitElement).eq(e),Math.abs(b)>=f.data("responsiveCarousel").left&&Math.abs(b)<f.data("responsiveCarousel").right){c.currentSlide=
f.data("slide");break}}else c.currentSlide=d(a.unitElement).eq([Math.abs(b/c.unitWidth)]).data("slide");if(d.isFunction(a.onShift))a.onShift(c.currentSlide);d(a.target).find("img").trigger("appear")},_clearInterval:function(){var a=this.internal,c=this.options,b=d(c.target);"number"===typeof a.timer&&(a.isArrowBeingClicked=!1,j.clearInterval(a.timer));!1===a.busy&&(a.busy=!0,this._animate(b,{left:this.computeAdjust(b)},c.speed,function(){a.busy=!1}))},_doArrowBeingClicked:function(a){var c=this,b=
this.internal,f=this.options,e=d(f.target),h=Math.floor(e.position().left);if(!0!==b.busy){if("individual"===f.unitWidth)if("right"===a)a=d(f.unitElement).eq(b.currentSlide+1).length?-1*d(f.unitElement).eq(b.currentSlide+1).data("responsiveCarousel").left:h-(b.nudgeThreshold?b.nudgeThreshold:20);else if("left"===a)a=d(f.unitElement).eq(b.currentSlide-1).length?-1*d(f.unitElement).eq(b.currentSlide-1).data("responsiveCarousel").left:h+(b.nudgeThreshold?b.nudgeThreshold:20);else throw Error("unknown direction");
else if("left"===a)a=h+b.unitWidth;else if("right"===a)a=h-b.unitWidth;else throw Error("unknown direction");a=Math.floor(a);b.busy=!0;this._animate(e,{left:a},f.speed,function(){c._setArrowVisibility();b.busy=!1})}},_setArrowEvents:function(){var a=this,c=this.options,b=this.internal,f=d(c.arrowLeft),e=d(c.arrowRight),h="",g="";f.on("click"+this.instanceId,function(a){a.preventDefault()});e.on("click"+this.instanceId,function(a){a.preventDefault()});!0===c.dragEvents?(h="mousedown"+this.instanceId+
" touchstart"+this.instanceId,g="mouseup"+this.instanceId+" mouseout"+this.instanceId+" mouseleave"+this.instanceId+" touchend"+this.instanceId+" touchleave"+this.instanceId):(h="mousedown"+this.instanceId,g="mouseup"+this.instanceId+" mouseout"+this.instanceId+" mouseleave"+this.instanceId);f.on(h,function(c){c.preventDefault();c.stopPropagation();!1===b.busy&&!f.hasClass("disabled")&&(b.isArrowBeingClicked=b.firstMouseClick=!0,b.timer=j.setInterval(function(){a._doArrowBeingClicked("left")},10),
b.slideTimer&&(j.clearInterval(b.slideTimer),b.slideShowActive=!1))});e.on(h,function(c){c.preventDefault();c.stopPropagation();!1===b.busy&&!e.hasClass("disabled")&&(b.isArrowBeingClicked=b.firstMouseClick=!0,b.timer=j.setInterval(function(){a._doArrowBeingClicked("right")},10),b.slideTimer&&(j.clearInterval(b.slideTimer),b.slideShowActive=!1))});d.each([f,e],function(){d(this).on(g,function(){!0===b.isArrowBeingClicked&&a._clearInterval()})});d(j).on("scroll"+this.instanceId+" resize"+this.instanceId+
" onorientationchange"+this.instanceId,function(){a._clearInterval()})},_setUnitWidth:function(){var a,c,b=this,f=this.internal,e=this.options,h=d(e.target),g=d(this.element),k=d(e.unitElement+":not(.clone)"),p=k.eq(0),l,m=function(){f.unitWidth=p.width()},q=function(){var b=d(e.mask).width();c=e.responsiveUnitSize(g,f,e);if("number"!==typeof c||1>c)throw Error("The responsiveUnitSize callback must return a whole number greater than 0");a=b/c;a=Math.floor(a);d(e.unitElement).css("width",a);!0===e.infinite&&
(0<c&&c!==f.numVisibleUnits)&&(f.numVisibleUnits=c,h.find(".clone").remove(),k.slice(0,f.numVisibleUnits).clone(!0).addClass("clone").appendTo(h));f.unitWidth=a;f.numVisibleUnits=c};if("inherit"===e.unitWidth)m(),h.find("img").one("load"+b.instanceId,function(){m();b._setTargetWidth("inherit");b._setArrowVisibility();if(d.isFunction(e.onRedraw))e.onRedraw(g,f,e)});else if("individual"===e.unitWidth){if(d.isFunction(e.onRedraw))e.onRedraw(g,f,e);h.find("img").one("load"+b.instanceId,function(){b._setTargetWidth("individual");
b._setArrowVisibility();if(d.isFunction(e.onRedraw))e.onRedraw(g,f,e)});d(j).on("resize"+b.instanceId,function(){clearTimeout(l);l=setTimeout(function(){var a;b._setTargetWidth("individual (window resize)");a=-1*d(e.unitElement).eq(f.currentSlide).data("responsiveCarousel").left;h.css({left:a});b._setArrowVisibility();if(d.isFunction(e.onRedraw))e.onRedraw(g,f,e)},400)})}else if("compute"===e.unitWidth){m();d.isFunction(e.responsiveUnitSize)&&(q(),m());if(d.isFunction(e.onRedraw))e.onRedraw(g,f,e);
h.find("img").each(function(){d(this).one("load"+b.instanceId,function(){d.isFunction(e.responsiveUnitSize)&&q();m();b._setTargetWidth("compute");b._setArrowVisibility();if(d.isFunction(e.onRedraw))e.onRedraw(g,f,e)})});d(j).on("resize"+b.instanceId,function(){clearTimeout(l);l=setTimeout(function(){var a;d.isFunction(e.responsiveUnitSize)&&(q(),m());m();b._setTargetWidth("compute (window resize)");a=-1*f.currentSlide*f.unitWidth;a<-1*f.maskWidth&&(a=f.maskWidth-f.targetWidth);h.css({left:a});b._setArrowVisibility();
if(d.isFunction(e.onRedraw))e.onRedraw(g,f,e)},400)})}else f.unitWidth=e.unitWidth},_dragEvents:function(){var a=this,c=this.options,b=this.internal,f=d(c.target),e=d(c.mask),h=new Hammer(e.get(0),{drag:!0,drag_vertical:!1,drag_horizontal:!0,drag_min_distance:10,transform:!1,tap:!1,tap_double:!1,hold:!1}),g={},k;b.touchObject=h;h.ondragstart=function(){if(!0===b.isArrowBeingClicked||!0===b.busy)return{};a.stopSlideShow();b.busy=!0;g={top:parseInt(f.css("top"),10),left:parseInt(f.css("left"),10)};
g.time=(new Date).getTime();b.scrollStart=g;if(d.isFunction(c.ondragstart))c.ondragstart(c,b)};h.ondrag=function(a){clearTimeout(k);k=setTimeout(function(){if(!0===b.busy)h.ondragend()},100);if(!0!==b.isArrowBeingClicked){var e=c.delta,d,j,n=-1*b.unitWidth*(b.numUnits-b.numVisibleUnits);if("up"===a.direction||"left"===a.direction)a.distance*=-1;d=g.left+a.distance*e;j=Math.abs(b.scrollStart.left-d);b.nudgeDirection=j>c.nudgeThreshold&&j<b.unitWidth/2?"up"===a.direction||"left"===a.direction?"left":
"right":null;!0===c.infinite&&(d<=n&&(d=0+a.distance*e),0<=d&&(d=n+a.distance*e));b.left=d;f.css("left",d)}};h.ondragend=function(){f.stop(!0,!1);a._animate(f,{left:a.computeAdjust(f)},c.speed,function(){a._setArrowVisibility();b.busy=!1;if(d.isFunction(c.ondragend))c.ondragend(c,b)})}},_create:function(){n+=1;var a=this.options,c=d(this.element),b=d(a.target);this.instanceId=".carousel_"+n.toString(10);this.internal={busy:!1,currentSlide:0,left:0,targetWidth:0,targetHeight:0,maskWidth:0,maskHeight:0,
unitWidth:0,targetBackupCopy:null,isArrowBeingClicked:!1,arrowLeftVisible:!0,arrowRightVisible:!0,targetLeft:0,timer:null,firstMouseClick:!1,prefix:null,slideShowActive:!1,slideTimer:null,slideBumped:!1,nudgeDirection:null,infinite:!1,numUnits:null,numVisibleUnits:null,scrollStart:0,touchObject:null};this.internal.targetBackupCopy=this.element;this.options.cssAnimations&&(this.internal.prefix=this._getPrefix("transition"));b.css({position:"relative",left:0});d(a.unitElement).each(function(a){d(this).attr({"data-slide":a})});
!0===a.dragEvents&&this._dragEvents();this._setArrowEvents();this._setUnitWidth();this._setTargetWidth("first load");this._setArrowVisibility();if(d.isFunction(a.onRedraw))a.onRedraw(c,this.internal,a)},redraw:function(){var a=this.internal,c=this.options,b=d(this.element);void 0===this.unitWidth&&this._setUnitWidth();this._setTargetWidth("_redraw");this._setArrowVisibility();if(d.isFunction(this.options.onRedraw))this.options.onRedraw(b,a,c)},getCurrentSlide:function(){return this.internal.currentSlide},
goToSlide:function(a,c){var b=this,f=this.internal,e=this.options,h=d(e.target),g;c=void 0!==c?c:!0;void 0===this.unitWidth&&this._setUnitWidth();g="individual"===e.unitWidth?d(e.unitElement).eq(a).data("responsiveCarousel").left:-1*a*f.unitWidth;f.busy=!0;!0===c?this._animate(h,{left:g},e.speed,function(){f.busy=!1;b._setArrowVisibility()}):h.css("left",g)},toggleSlideShow:function(){!1===this.internal.slideShowActive?this.startSlideShow():this.stopSlideShow()},_step:function(a){var c=this,b=this.internal,
f=this.options,e=d(f.target),h=b.maskWidth,g=this._round(Math.floor(e.position().left)),k=g+a*b.unitWidth,j=g+b.targetWidth;a=j+a*b.unitWidth;var l=k;!1===b.slideBumped?!1===f.infinite&&(a<=h&&(l=k+h-a,b.slideBumped="left"),0<=k&&(b.slideBumped="right",l=0)):("left"===b.slideBumped&&(l=0),"right"===b.slideBumped&&(l=g+h-j),b.slideBumped=!1);b.busy=!0;this._animate(e,{left:l},f.speed,function(){b.busy=!1;c._setArrowVisibility()})},startSlideShow:function(){var a=this,c=this.internal,b=this.options;
!1===c.slideShowActive&&(c.slideShowActive=!0,c.slideTimer=j.setInterval(function(){a._step(b.step)},b.slideSpeed))},stopSlideShow:function(){var a=this.internal;!0===a.slideShowActive&&(a.slideShowActive=!1,j.clearInterval(a.slideTimer))},_destroy:function(){var a=d(this.options.target),c=d(this.options.mask);d(this.options.arrowLeft).unbind(this.instanceId);d(this.options.arrowRight).unbind(this.instanceId);a.find("img").unbind(this.instanceId);null!==this.internal.touchObject&&this.internal.touchObject.destroy();
c.css({"-webkit-user-select":"","-webkit-user-drag":"","-webkit-tap-highlight-color":""});j.setTimeout(function(){a.css({position:"",left:"",width:""})},1)},computeAdjust:function(a){var c=this.internal,b=this.options;a=Math.floor(a.position().left);var f,e=c.unitWidth/-2,h=c.maskWidth,g;f=c.nudgeDirection;var k=c.unitWidth,j=!1;null!==f&&("left"===f&&(g=a-k),"right"===f&&(g=a+k),a=g);f=a+c.targetWidth;f<h&&(a=g=a+h-f,j=!0);0<a&&(a=g=0);if("individual"===b.unitWidth)for(f=0;f<c.numUnits;f++)if(e=
d(b.unitElement).eq(f),!0==j)c.targetWidth>h&&(g=c.maskWidth-c.targetWidth);else{if(Math.abs(a)>=e.data("responsiveCarousel").left&&Math.abs(a)<=e.data("responsiveCarousel").right){g=-1*e.data("responsiveCarousel").left;break}}else c=a%this.internal.unitWidth,0!==c&&(c<e&&(g=a-(this.internal.unitWidth+c)),c>e&&(g=a-c));return g}})})(jQuery,window,document);
