/*!
 * responsiveCarousel
 * A responsive carousel that works in desktop browsers, ipad, iphone, and even
 * most Androids.  It uses css3 animations with a jquery animation fallback for
 * greater speed.  The code was optimized to minimize page reflows to further
 * enhance the overall speed.  Doesn't try and solve everything, small and
 * compact for specific use..
 *
 * This is a jQuery UI Widget
 *
 * @version 0.6.0
 * @releaseDate 1/17/2013
 * @author Matthew Toledo
 * @url https://github.com/mrbinky3000/responsive_carousel
 * @requires jQuery, jQuery UI (only the Core and Widget Factory), modernizr (only css3 transitions test, touch test optional), hammer.js
 */
(function(d,j,s){var k=!1;d.widget("ri.responsiveCarousel",{options:{autoWrap:!1,arrowLeft:".arrow-left span",arrowRight:".arrow-right span",mask:".slider-mask",target:"ul",unitElement:"li",unitWidth:"inherit",responsiveUnitSize:null,onRedraw:null,ondragstart:null,ondragend:null,dragEvents:!1,speed:400,slideSpeed:2500,step:-1,responsiveStep:null,onShift:null,cssAnimations:Modernizr.csstransitions,nudgeThreshold:10,infinite:!1,delta:1},wait:function(){var b;return{thenDo:function(a,c){void 0!==b&&
j.clearTimeout(b);b=j.setTimeout(a,c)}}},_getPrefix:function(b){for(var a=["Moz","Webkit","Khtml","0","ms"],c=s.createElement("div"),f=b.charAt(0).toUpperCase()+b.slice(1),e="",d=a.length;-1<d;)void 0!==c.style[a[d]+f]&&(e=a[d]),d-=1;return e=c.style[b]?b.toLowerCase():"-"+e.toLowerCase()+"-"},_animate:function(b,a,c,f){var e=this.options,g=this.internal,h=g.prefix+"transition",q=b.position().left,l=a.left,k=q+l;!0===e.infinite&&void 0!==l&&(l<q?(l=-1*g.unitWidth*(g.numUnits-g.numVisibleUnits),q===
l&&(b.css({transition:"",left:0}),a.left=-g.unitWidth)):l>q&&0===q&&(l=-1*b.find(".clone:first").position().left,b.css({transition:"",left:l}),a.left=l+k));j.setTimeout(function(){e.cssAnimations?(b.css(h,"all "+c/1E3+"s ease-in-out").css(a),j.setTimeout(function(){b.css(h,"");d.isFunction(f)&&f()},c)):b.animate(a,c,function(){d.isFunction(f)&&f()})},1)},_setTargetWidth:function(){var b=this.internal,a=this.options;d(this.element);var c=d(a.target);b.numUnits=d(a.unitElement).length;"individual"===
a.unitWidth?(b.targetWidth=0,d(a.unitElement).each(function(){var a=d(this),c=0;a.css("width","");c=Math.ceil(a.width())+1;a.width(c);b.targetWidth+=c;d(this).data("responsiveCarousel",{width:c,top:a.position().top,right:a.position().left+a.outerWidth(),bottom:a.position().top+a.outerHeight(),left:a.position().left})})):b.targetWidth=b.numUnits*b.unitWidth;d(a.target).width(b.targetWidth);b.targetOuterWidth=c.outerWidth();b.targetOuterHeight=c.outerHeight();b.targetParentOuterWidth=c.parent().outerWidth();
b.targetParentInnerWidth=c.parent().innerWidth();b.targetParentOuterHeight=c.parent().outerHeight();b.targetParentMarginLeft=parseInt(c.parents().css("marginLeft"),10);isNaN(b.targetParentMarginLeft)&&(b.targetParentMarginLeft=0)},_setArrowVisibility:function(){var b=this.options,a=this.internal,c=d(b.target).position().left,f=a.targetOuterWidth+c,e=d(b.arrowLeft),g=d(b.arrowRight),h=a.targetParentOuterWidth;g.length&&(!0!==b.infinite&&f<=h?(g.addClass("disabled"),!0===a.isArrowBeingClicked&&this._clearInterval(),
a.arrowRightVisible=a.isArrowBeingClicked=!1):!1===a.arrowRightVisible&&(g.removeClass("disabled"),a.arrowRightVisible=!0));e.length&&(!0!==b.infinite&&0<=c?(e.addClass("disabled"),!0===a.isArrowBeingClicked&&this._clearInterval(),a.arrowLeftVisible=a.isArrowBeingClicked=!1):!1===a.arrowLeftVisible&&(e.removeClass("disabled"),a.arrowLeftVisible=!0));if("individual"===b.unitWidth)for(e=0;e<a.numUnits;e++){if(f=d(b.unitElement).eq(e),Math.abs(c)>=f.data("responsiveCarousel").left&&Math.abs(c)<f.data("responsiveCarousel").right){a.currentSlide=
f.data("slide");break}}else a.currentSlide=d(b.unitElement).eq([Math.abs(c/a.unitWidth)]).data("slide");if(d.isFunction(b.onShift))b.onShift(a.currentSlide)},_clearInterval:function(){var b=this.internal,a=this.options,c=d(a.target);"number"===typeof b.timer&&(b.isArrowBeingClicked=!1,j.clearInterval(b.timer));!1===k&&(k=!0,this._animate(c,{left:this.computeAdjust(c)},a.speed,function(){k=!1}))},_doArrowBeingClicked:function(b){var a=this,c=this.internal,f=this.options,e=d(f.target),g=e.position().left,
h=c.targetParentMarginLeft;if(!0!==k){if("individual"===f.unitWidth)if("right"===b)b=d(f.unitElement).eq(c.currentSlide+1).length?-1*d(f.unitElement).eq(c.currentSlide+1).data("responsiveCarousel").left:g-(c.nudgeThreshold?c.nudgeThreshold:20);else if("left"===b)b=d(f.unitElement).eq(c.currentSlide-1).length?-1*d(f.unitElement).eq(c.currentSlide-1).data("responsiveCarousel").left:g+(c.nudgeThreshold?c.nudgeThreshold:20);else throw Error("unknown direction");else if("left"===b)b=g-h+c.unitWidth;else if("right"===
b)b=g-h-c.unitWidth;else throw Error("unknown direction");k=!0;this._animate(e,{left:b},f.speed,function(){a._setArrowVisibility();k=!1})}},_setArrowEvents:function(){var b=this,a=this.options,c=this.internal,f=d(a.arrowLeft),e=d(a.arrowRight),g="",h="";f.on("click.responsiveCarousel",function(a){a.preventDefault()});e.on("click.responsiveCarousel",function(a){a.preventDefault()});!0===a.dragEvents?(g="mousedown.responsiveCarousel touchstart.responsiveCarousel",h="mouseup.responsiveCarousel mouseout.responsiveCarousel mouseleave.responsiveCarousel touchend.responsiveCarousel touchleave.responsiveCarousel"):
(g="mousedown.responsiveCarousel",h="mouseup.responsiveCarousel mouseout.responsiveCarousel mouseleave.responsiveCarouse");f.on(g,function(a){a.preventDefault();a.stopPropagation();!1===k&&!f.hasClass("disabled")&&(c.isArrowBeingClicked=c.firstMouseClick=!0,c.timer=j.setInterval(function(){b._doArrowBeingClicked("left")},10),c.slideTimer&&(j.clearInterval(c.slideTimer),c.slideShowActive=!1))});e.on(g,function(a){a.preventDefault();a.stopPropagation();!1===k&&!e.hasClass("disabled")&&(c.isArrowBeingClicked=
c.firstMouseClick=!0,c.timer=j.setInterval(function(){b._doArrowBeingClicked("right")},10),c.slideTimer&&(j.clearInterval(c.slideTimer),c.slideShowActive=!1))});d.each([f,e],function(){d(this).on(h,function(){!0===c.isArrowBeingClicked&&b._clearInterval()})});d(j).on("scroll.responsiveCarousel resize.responsiveCarousel onorientationchange.responsiveCarousel",function(){b._clearInterval()})},_setUnitWidth:function(){var b,a,c=this,f=this.internal,e=this.options,g=d(e.target),h=d(this.element),k=d(e.unitElement+
":not(.clone)"),l=k.eq(0),m=new this.wait,p=function(){f.unitWidth=l.outerWidth()},n=function(){var c=d(e.mask).innerWidth();a=e.responsiveUnitSize(h,f,e);if("number"!==typeof a||1>a)throw Error("The responsiveUnitSize callback must return a whole number greater than 0");b=c/a;b=Math.floor(b);d(e.unitElement).css("width",b);!0===e.infinite&&(0<a&&a!==f.numVisibleUnits)&&(f.numVisibleUnits=a,g.find(".clone").remove(),k.slice(0,f.numVisibleUnits).clone(!0).addClass("clone").appendTo(g));f.unitWidth=
b;f.numVisibleUnits=a};if("inherit"===e.unitWidth)p(),g.find("img").on("load.responsiveCarousel",function(){p();c._setTargetWidth("inherit");c._setArrowVisibility();if(d.isFunction(e.onRedraw))e.onRedraw(h,f,e)});else if("individual"===e.unitWidth){if(d.isFunction(e.onRedraw))e.onRedraw(h,f,e);g.find("img").one("load",function(){c._setTargetWidth("individual");c._setArrowVisibility();if(d.isFunction(e.onRedraw))e.onRedraw(h,f,e)});d(j).on("resize.responsiveCarousel",function(){m.thenDo(function(){var a;
c._setUnitWidth();c._setTargetWidth("individual (window resize)");a=-1*d(e.unitElement).eq(f.currentSlide).data("responsiveCarousel").left;g.css({left:a});c._setArrowVisibility();if(d.isFunction(e.onRedraw))e.onRedraw(h,f,e)},1E3)})}else if("compute"===e.unitWidth){p();d.isFunction(e.responsiveUnitSize)&&(n(),p());if(d.isFunction(e.onRedraw))e.onRedraw(h,f,e);g.find("img").each(function(){d(this).one("load",function(){d.isFunction(e.responsiveUnitSize)&&n();p();c._setTargetWidth("compute");c._setArrowVisibility();
if(d.isFunction(e.onRedraw))e.onRedraw(h,f,e)})});d(j).on("resize.responsiveCarousel",function(){m.thenDo(function(){c._setUnitWidth();d.isFunction(e.responsiveUnitSize)&&n();p();c._setTargetWidth("compute (window resize)");g.css({left:-1*f.currentSlide*f.unitWidth});c._setArrowVisibility();if(d.isFunction(e.onRedraw))e.onRedraw(h,f,e)},1E3)})}else f.unitWidth=e.unitWidth},_dragEvents:function(){var b=this,a=this.options,c=this.internal,f=d(a.target),e=f.parent(),g=new Hammer(e.get(0),{drag:!0,drag_vertical:!1,
drag_horizontal:!0,drag_min_distance:10,transform:!1,tap:!1,tap_double:!1,hold:!1}),h={},j=new this.wait;c.touchObject=g;g.ondragstart=function(){if(!0===c.isArrowBeingClicked||!0===k)return{};k=!0;h={top:parseInt(f.css("top"),10),left:parseInt(f.css("left"),10)};h.time=(new Date).getTime();c.scrollStart=h;if(d.isFunction(a.ondragstart))a.ondragstart(a,c)};g.ondrag=function(b){j.thenDo(function(){if(!0===k)g.ondragend()},100);if(!0!==c.isArrowBeingClicked){var e=a.delta,d,n,r=-1*c.unitWidth*(c.numUnits-
c.numVisibleUnits);if("up"===b.direction||"left"===b.direction)b.distance*=-1;d=h.left+b.distance*e;n=Math.abs(c.scrollStart.left-d);c.nudgeDirection=n>a.nudgeThreshold&&n<c.unitWidth/2?"up"===b.direction||"left"===b.direction?"left":"right":null;!0===a.infinite&&(d<=r&&(d=0+b.distance*e),0<=d&&(d=r+b.distance*e));c.left=d;f.css("left",d)}};g.ondragend=function(){f.stop(!0,!1);b._animate(f,{left:b.computeAdjust(f)},a.speed,function(){b._setArrowVisibility();k=!1;if(d.isFunction(a.ondragend))a.ondragend(a,
c)})}},_initAnimationFrame:function(){for(var b=0,a=["ms","moz","webkit","o"],c=0;c<a.length&&!j.requestAnimationFrame;++c)j.requestAnimationFrame=j[a[c]+"RequestAnimationFrame"],j.cancelAnimationFrame=j[a[c]+"CancelAnimationFrame"]||j[a[c]+"CancelRequestAnimationFrame"];j.requestAnimationFrame||(j.requestAnimationFrame=function(a){var c=(new Date).getTime(),d=Math.max(0,16-(c-b)),h=j.setTimeout(function(){a(c+d)},d);b=c+d;return h});j.cancelAnimationFrame||(j.cancelAnimationFrame=function(a){clearTimeout(a)})},
_create:function(){var b=this.options,a=d(this.element),c=d(b.target);this.internal={currentSlide:0,left:0,targetWidth:0,unitWidth:0,targetOuterWidth:0,targetOuterHeight:0,targetParentOuterWidth:0,targetParentInnerWidth:0,targetParentOuterHeight:0,targetParentMarginLeft:0,targetBackupCopy:null,isArrowBeingClicked:!1,arrowLeftVisible:!0,arrowRightVisible:!0,targetLeft:0,timer:null,firstMouseClick:!1,prefix:null,slideShowActive:!1,slideTimer:null,slideBumped:!1,nudgeDirection:null,infinite:!1,numUnits:null,
numVisibleUnits:null,scrollStart:0,touchObject:null};this._initAnimationFrame();this.internal.targetBackupCopy=this.element;this.options.cssAnimations&&(this.internal.prefix=this._getPrefix("transition"));c.css({position:"relative",left:0});d(b.unitElement).each(function(a){d(this).attr({"data-slide":a})});!0===b.dragEvents&&this._dragEvents();this._setArrowEvents();this._setUnitWidth();this._setTargetWidth("first load");this._setArrowVisibility();if(d.isFunction(b.onRedraw))b.onRedraw(a,this.internal,
b)},redraw:function(){var b=this.internal,a=this.options,c=d(this.element);this._setUnitWidth();this._setTargetWidth("_redraw");this._setArrowVisibility();if(d.isFunction(this.options.onRedraw))this.options.onRedraw(c,b,a)},getCurrentSlide:function(){return this.internal.currentSlide},goToSlide:function(b,a){var c=this,f=this.internal,e=this.options,g=d(e.target);a=void 0!==a?a:!0;this._setUnitWidth();f="individual"===e.unitWidth?d(e.unitElement).eq(b).data("responsiveCarousel").left:-1*b*f.unitWidth;
k=!0;!0===a?this._animate(g,{left:f},e.speed,function(){k=!1;c._setArrowVisibility()}):g.css("left",f)},toggleSlideShow:function(){var b=this,a=this.internal,c=this.options,f=d(c.target);!1===a.slideShowActive?(a.slideShowActive=!0,a.slideTimer=j.setInterval(function(){var d=c.step,g=a.targetParentInnerWidth,h=f.position().left,j=h+a.targetWidth,l=h+d*a.unitWidth,d=j+d*a.unitWidth,m=l;!1===a.slideBumped?!1===c.infinite&&(d<=g&&(m=l+g-d,a.slideBumped="left"),0<=l&&(a.slideBumped="right",m=0)):("left"===
a.slideBumped&&(m=0),"right"===a.slideBumped&&(m=h+g-j),a.slideBumped=!1);k=!0;b._animate(f,{left:m},c.speed,function(){k=!1;b._setArrowVisibility()})},c.slideSpeed)):!0===a.slideShowActive&&(a.slideShowActive=!1,j.clearInterval(a.slideTimer))},_destroy:function(){var b=d(this.options.target),a=d(this.options.mask);d(j).unbind(".responsiveCarousel");d(this.options.arrowLeft).unbind(".responsiveCarousel");d(this.options.arrowRight).unbind(".responsiveCarousel");b.find("img").unbind(".responsiveCarousel");
null!==this.internal.touchObject&&this.internal.touchObject.destroy();a.css({"-webkit-user-select":"","-webkit-user-drag":"","-webkit-tap-highlight-color":""});j.setTimeout(function(){b.css({position:"",left:"",width:""})},1)},computeAdjust:function(b){var a=this.internal,c=this.options;b=b.position().left;var f,e=a.unitWidth/-2,g=a.targetParentInnerWidth,h;f=a.nudgeDirection;var j=a.unitWidth,k=!1;null!==f&&("left"===f&&(h=b-j),"right"===f&&(h=b+j),b=h);f=b+a.targetWidth;f<g&&(b=h=b+g-f,k=!0);0<
b&&(b=h=0);if("individual"===c.unitWidth)for(f=0;f<a.numUnits;f++)if(e=d(c.unitElement).eq(f),!0==k)a.targetWidth>g&&(h=a.targetParentInnerWidth-a.targetWidth);else{if(Math.abs(b)>=e.data("responsiveCarousel").left&&Math.abs(b)<=e.data("responsiveCarousel").right){h=-1*e.data("responsiveCarousel").left;break}}else a=b%this.internal.unitWidth,0!==a&&(a<e&&(h=b-(this.internal.unitWidth+a)),a>e&&(h=b-a));return h}})})(jQuery,window,document);
